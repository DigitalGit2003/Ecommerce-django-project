{% extends 'app/base.html' %}
{% load static %}
{% block title %}Checkout{% endblock title %}
{% block main-content %}

<div class="container">
  <div class="row mt-5">
    <div class="col-sm-6">
      <h4>Order Summary</h4>
      <hr>
      {% for item in cart_items%}
      <div class="card mb-2">
        <div class="card-body">
          <h5>Product: {{item.product.title}}</h5>
          <p>Quantity: {{item.quantity}}</p>
          <p class="fw-bold">Price: {{item.total_cost}}</p>
        </div>
      </div>
      {% endfor %}
      <p class="fw-bold">Total Cost + Rs. 70 = {{totalamount}}</p>
      <small>Term and Condition: Lorem ipsum dolor sit amet consectetur adipisicing elit. Mollitia, ullam saepe! Iure
        optio repellat dolor velit, minus rem. Facilis cumque neque numquam laboriosam, accusantium adipisci nisi nihil
        in et quis?</small>
    </div>
    <div class="col-sm-4 offset-sm-1">
      <h4>Select Shipping Address</h4>
      <hr>
      <form action="/paymentdone" id="myform">
        {% for add in address %}
        <div class="card">
          <div class="card-body">
            <h5>{{add.name}}</h5>
            <p>{{add.locality}}, {{add.city}}, {{add.state}} - {{add.pincode}}</p>
          </div>
        </div>
        <div class="form-check mt-2 mb-5">
          <input required class="form-check-input" type="radio" name="cust_id" id="custadd{{forloop.counter}}"
            value="{{add.id}}">
          <label class="form-check-label fw-bold" for="custadd{{forloop.counter}}"> Address: {{forloop.counter}}
          </label>
        </div>
        {% endfor %}
        <div class="text-end">
          <div class="container text-center" >
            <div class="bg-primary border" style="border-width: 110px">
              <p class="fw-bold text-light"> Payment Option: </p>
            </div>
            <div class="col-md-6 col-lg-6 col-xlg-6 col-sm-12 mx-auto my-4 bg-light " >
                <button id="paypal-button-container" style="height: 100px; width: 200px;"></button>
            </div>
          </div>
        
          <script>
            paypal.Button.render({
    
                env: 'sandbox', // sandbox | production
    
                // PayPal Client IDs - replace with your own
                // Create a PayPal app: https://developer.paypal.com/developer/applications/create
                client: {
                    sandbox:    'AbG7-M-NBMuNJSOehRW0VsqB3leTab22yBcNUhPFuuMGMxNbiuEAvM-BBhS6n_3BhBZ-KTN48vPp6GCJ',
                    production: '<insert production client id>'
                },
    
                // Show the buyer a 'Pay Now' button in the checkout flow
                commit: true,
    
                // payment() is called when the button is clicked
                payment: function(data, actions) {
                    // Make a call to the REST api to create the payment
                    return actions.payment.create({
                        payment: {
                            transactions: [
                                {
                                    amount: { total: '{{totalamount}}', currency: 'USD' }
                                }
                            ]
                        }
                    });
                },
    
                // onAuthorize() is called when the buyer approves the payment
                onAuthorize: function(data, actions) {
                    // Make a call to the REST api to execute the payment
                    return actions.payment.execute().then(function() {
                        window.alert('Payment Complete!');
                        document.getElementById("myform").submit();
                    });
                }
    
            }, '#paypal-button-container');
        </script>

        </div>
      </form>
    </div>
  </div>
</div>
{% endblock main-content %}